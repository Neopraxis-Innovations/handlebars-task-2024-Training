---
product:
    videos:
        limit: {{theme_settings.productpage_videos_count}}
    reviews:
        limit: {{theme_settings.productpage_reviews_count}}
    related_products:
        limit: {{theme_settings.productpage_related_products_count}}
    similar_by_views:
        limit: {{theme_settings.productpage_similar_by_views_count}}
---
{{inject 'productId' product.id}}

{{#partial "page"}}


<div class="cm-bundle-builder-wrapper listing-section">
    <div class="row">
        <div class="columns large-12 bundlebar-main">
            <div class="columns small-4 large-4 bundlebar bundlebar-width-left">
                <div class="columns large-6">
                    <img src="{{getImage product.main_image}}"
                        alt="">
                </div>
                <div class="columns large-6">
                    <div class="bundlebar-product-detail">
                        {{head.title}}
                    </div>
                </div>
            </div>
            <div class="columns small-4 large-4 bundlebar">
                <div class="columns small-12 large-12 bundlebar-listing-items" id="bundlebar-listing-items">
                    <p class="cm-bundle-text">Choose add-ons and services to create your bundle, or say “None.”</p>
                </div>

            </div>
            <div class="columns small-4 large-4 bundlebar-width-right">
                <div class="columns small-6 large-6 bundlebar-price-button-container">

                    <div class="bundlebar-product-price" 
                        data-main_product_price="{{product.price.without_tax.value}}" 
                        id="totalPriceYo">
                        {{product.price.without_tax.value}}
                    </div>

                    <div class="bundlebar-button-below-content">
                        *or 4 payments of &#36;75.00
                    </div>
                </div>
                <div class="bundlebar-button-price">
                    <button class="bar-button">Add to Cart</button>
                </div>
                <div class="bundlebar-button-below-content">
                    *discount will be applied at cart
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="columns large-12">
            <h1 class="bundle-heading-description">Add a rear-facing camera module.</h1>
            <p class="bundle-heading-peragraph">Only one camera can be used at a time.</p>
        </div>
    </div>

 
    <div class="row listing-section">

        {{#each product.related_products}}
     
        <div class="columns small-6 large-3 bundle-product-allignment">
            <div class="bundle-product-content-main" id="bundle-product-content-main">
                <div class="bundle-product-name" id="bundle-name" data-name="{{name}}">
                    {{name}}
                </div>
                <div class="bundle-product-price" data-price="{{price.without_tax.value}}" id="main_product_price">
                    {{price.without_tax.formatted}}
                </div>
                <div class="product-image-bundle">
                    <img class="product-image-bundle-img" src="{{getImage image}}"
                        alt="" height="50px" data-image="{{getImage image}}">
                </div>
                <div class="row bundle-product-content-button">
                    <div class="columns small-6 large-6">
                        <button class="bar-button-learn">Learn more</button>
                    </div>
                    <div class="columns small-6 large-6">
                        <button class="bar-button bar-button-bundle" id="button_add_bundle-{{id}}" 
                        data-image="{{getImage image}}" 
                        data-price="{{price.without_tax.value}}" 
                        data-name="{{name}}">Add to bundle</button>
                    </div>
                </div>
            </div>
        </div>
        {{/each}}
    </div>

<script>
        document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM is fully loaded!');
        const buttonsAddBundle = document.querySelectorAll('.bar-button-bundle');
        const collectionOfData = [];

        var priceElement = document.getElementById("totalPriceYo");
        var mainProductPrice = parseFloat(priceElement.getAttribute("data-main_product_price"));

        let total = mainProductPrice;

        console.log("Main product price >>>>>", mainProductPrice);
        
        priceElement.innerHTML = "€"+total.toFixed(2);

        buttonsAddBundle.forEach((button) => {
            button.addEventListener('click', function() {
                const bundleText = document.querySelector('.cm-bundle-text');
                if (bundleText) {
                    bundleText.classList.add('some-class');
                }
                const dataPrice = parseFloat(button.getAttribute('data-price'));
                const dataName = button.getAttribute('data-name');
                const dataImage = button.getAttribute('data-image');

                const existingItem = collectionOfData.find(item => item.name === dataName);

                if (!existingItem) {
                    const extractData = {
                        price: dataPrice,
                        name: dataName,
                        image: dataImage
                    };
                    collectionOfData.push(extractData);
                    console.log('Extracted data ===>', extractData);
                    button.textContent = "Remove";

                    borderColorAdd();
                } else {
                    collectionOfData.splice(collectionOfData.indexOf(existingItem), 1);
                    button.textContent = "Add to Bundle";

                    borderColorRemove();
                }

                updateProductList();
                updateTotalPrice();
            });
        });

        function updateProductList() {
            const productList = document.getElementById('bundlebar-listing-items');
            if (productList) {
                productList.innerHTML = '';
                collectionOfData.forEach(product => {
                    const productDiv = document.createElement('div');
                    productDiv.classList.add('bundlebar-listing-items-sub');
                    productDiv.innerHTML = `
                        <div>
                            <img class="bundlebar-listing-items_image" src="${product.image}" alt="${product.name}">
                            <div class="bundlebar-listing-items_text">${product.name}</div>
                        </div>
                    `;
                    productList.appendChild(productDiv);
                });
            } else {
                console.log('Product list not found!');
            }
        }

        function updateTotalPrice() {
            total = mainProductPrice;
            collectionOfData.forEach(item => {
                total += item.price;
            });
            priceElement.innerHTML = total.toFixed(2);
            console.log("Updated total price >>>>", total);
        }

        const productList = document.getElementById('bundlebar-listing-items');
        if (productList) {
            productList.addEventListener('click', function(event) {
                if (event.target.classList.contains('bundlebar-listing-items-sub')) {
                    const clickedItemText = event.target.querySelector('.bundlebar-listing-items_text').textContent;
                    const clickedItemIndex = collectionOfData.findIndex(item => item.name === clickedItemText);

                    if (clickedItemIndex !== -1) {
                        collectionOfData.splice(clickedItemIndex, 1);
                        event.target.remove();
                        buttonsAddBundle.forEach(button => {
                            if (button.getAttribute('data-name') === clickedItemText) {
                                button.textContent = "Add to Bundle";
                            }
                        });

                        // Call borderColorRemove when a product is removed from the list
                        borderColorRemove();

                        updateTotalPrice();
                    }
                }
            });
        } else {
            console.log('Product list not found!');
        }

    });

    function borderColorAdd() {
        const borderCardContainer = document.querySelectorAll('.bundle-product-content-main');
        borderCardContainer.forEach(card => {
            card.addEventListener("click", function() {
                this.style.border = "2px solid #8111bb";
            });
        });
    }

    function borderColorRemove() {
        const borderCardContainer = document.querySelectorAll('.bundle-product-content-main');
        borderCardContainer.forEach(card => {
            card.addEventListener("click", function() {
                this.style.border = "none";
            });
        });
    }

</script>

   
{{/partial}}
{{> layout/base}}